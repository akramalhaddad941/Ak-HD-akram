> # وثيقة التصميم المعماري (Architectural Design Document)

## 1. المقدمة
توفر هذه الوثيقة نظرة عامة على الهيكل المعماري للمشروع، وتوضح القرارات التصميمية الرئيسية، والمكونات الأساسية، وكيفية تفاعلها معًا.

## 2. الرؤية المعمارية
يعتمد التصميم على مبدأ **المرونة والوحداتية (Modularity)**، حيث يتم تقسيم النظام إلى وحدات مستقلة (Services) تتواصل عبر واجهات موحدة. الهدف هو بناء نظام قابل للتوسع والصيانة بسهولة داخل بيئة إضافات المتصفح.

## 3. المكونات المعمارية الرئيسية

| المكون | الوصف | التقنيات الرئيسية |
| :--- | :--- | :--- |
| **واجهة المستخدم (UI)** | مسؤولة عن عرض التراكب (Overlay)، الواجهة المنبثقة (Popup)، وصفحة الإعدادات (Options Page). | React, TypeScript, Shadow DOM |
| **طبقة التحكم (Control Layer)** | Background Script، مسؤولة عن إدارة حالة الإضافة، التوجيه بين الخدمات، والاتصال بالـ APIs. | TypeScript, Chrome Messaging API |
| **طبقة الخدمات (Services Layer)** | تحتوي على المنطق المعقد (الترجمة، STT، الخبراء، التخزين). هذه الطبقة هي قلب النظام. | TypeScript, Strategy Pattern, Adapter Pattern |
| **طبقة البيانات (Data Layer)** | مسؤولة عن التخزين المؤقت، تخزين الإعدادات، وإدارة مفاتيح API. | IndexedDB, Chrome Storage |

## 4. تدفق البيانات الرئيسي (Main Data Flow)

1.  **التقاط الصوت**: Content Script يلتقط الصوت ويرسله إلى Background Script.
2.  **STT**: Background Script يرسل الصوت إلى نظام STT المتقدم، ويستقبل النص المعترف به.
3.  **الترجمة**: النص يتم إرساله إلى نظام الترجمة الذكي الشامل.
4.  **توجيه الخبير**: نظام الترجمة يستدعي نظام الخبراء للحصول على توجيهات.
5.  **اختيار المحرك**: نظام الترجمة يختار المحرك المناسب (عبر وحدة محركات الترجمة المتعددة).
6.  **العرض**: النص المترجم يعود إلى Content Script للعرض عبر التراكب (Overlay).

## 5. القرارات المعمارية الرئيسية
*   **استخدام TypeScript**: لضمان سلامة النوع وتقليل الأخطاء في الأنظمة المعقدة.
*   **استخدام Shadow DOM**: لعزل التراكب (Overlay) ومنع تضارب CSS مع صفحات الويب.
*   **نمط المحول**: لتوحيد واجهات API الخارجية.
