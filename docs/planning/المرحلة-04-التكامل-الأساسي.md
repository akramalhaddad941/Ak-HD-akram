# المرحلة 04: التكامل الأساسي

تُعد هذه المرحلة حاسمة لضمان عمل جميع مكونات أداة ترجمة الفيديو معًا بشكل متناغم وفعال. تركز هذه المرحلة على دمج الواجهات مع النواة الأساسية، وتكامل واجهات برمجة التطبيقات، وإدارة البيانات، وتطبيق إجراءات الأمان، بالإضافة إلى إجراء اختبارات شاملة لضمان الجودة والأداء.

## 1. دمج الواجهة مع النواة: التواصل السلس

يهدف هذا الجزء إلى ربط واجهة المستخدم (UI Layer) مع النواة الأساسية (Core) التي تحتوي على محرك الترجمة ونظام التقاط الصوت. يجب أن يكون التواصل بين هذه المكونات سلسًا وفعالًا لتقديم تجربة مستخدم متكاملة.

**التعليمات:** قم بتنفيذ نظام رسائل قوي (باستخدام Chrome Messaging API) لتسهيل التواصل بين `Content Script`، `Background Script`، `Popup`، و `Options/Dashboard`. يجب أن يدعم آليات `Request-Response` و `Event Publishing` و `State Propagation`.

**عدد الملفات المتوقعة:** 3-5 ملفات (مثل `src/utils/messaging.ts`, `src/background/messageHandler.ts`, `src/content/messageSender.ts`). (مستخلص من: `المرحلةالرابعةالتكاملوالاختبار..md`)

## 2. تكامل واجهات برمجة التطبيقات (APIs): الخارجية والداخلية

يتضمن هذا الجزء التأكد من أن جميع واجهات برمجة التطبيقات، سواء الداخلية أو الخارجية، تعمل بشكل صحيح وتتفاعل بفعالية.

**التعليمات:** قم بدمج واجهات برمجة التطبيقات الداخلية (`TranslationAPI`, `AudioAPI`, `StorageAPI`) مع المكونات المعنية. تأكد من التكامل السلس مع واجهات برمجة التطبيقات الخارجية لخدمات الترجمة و STT والتخزين السحابي والتحليلات. يجب أن تستخدم `APIKeyConfig` من `src/types/common.ts`.

**عدد الملفات المتوقعة:** 5-8 ملفات (مثل `src/api/external/googleTranslateApi.ts`, `src/api/external/whisperApi.ts`, `src/api/analyticsApi.ts`, `src/api/cloudStorageApi.ts`). (مستخلص من: `المرحلةالرابعةالتكاملوالاختبار..md`)

## 3. إدارة البيانات: التخزين، الاسترجاع، المزامنة

تُعد الإدارة الفعالة للبيانات أمرًا حيويًا لضمان موثوقية الأداة وأدائها. يشمل ذلك التعامل مع تخزين البيانات، استرجاعها، ومزامنتها عبر الأجهزة.

**التعليمات:** قم بتنفيذ آليات التخزين (IndexedDB, Chrome Storage API) والاسترجاع والمزامنة (Sync Settings). يجب أن تدعم تصدير واستيراد البيانات بصيغ مختلفة (SRT, VTT, TXT, JSON, DOCX) والحفظ التلقائي. يجب أن تستخدم `DataExportFormat` و `SyncConfig` من `src/types/common.ts`.

**عدد الملفات المتوقعة:** 4-6 ملفات (مثل `src/data/dataManager.ts`, `src/data/indexedDbManager.ts`, `src/data/chromeStorageManager.ts`, `src/data/syncManager.ts`, `src/data/exportImport.ts`). (مستخلص من: `المرحلةالرابعةالتكاملوالاختبار..md`)

## 4. الأمان: التشفير، المصادقة، الصلاحيات

يجب أن يتم دمج تدابير أمنية قوية في جميع مراحل النظام لحماية بيانات المستخدم وضمان الخصوصية.

**التعليمات:** قم بتطبيق تشفير البيانات (Local Storage Encryption, Network Traffic Encryption)، حماية مفاتيح API، والمصادقة (JWT, MFA). يجب تنفيذ التحكم في الوصول والصلاحيات، وحماية الخصوصية (Local Processing, Data Anonymization). يجب أن تستخدم `SecurityConfig` من `src/types/common.ts`.

**عدد الملفات المتوقعة:** 5-7 ملفات (مثل `src/security/encryption.ts`, `src/security/authentication.ts`, `src/security/permissionManager.ts`, `src/security/privacyManager.ts`, `src/security/apiKeyProtection.ts`). (مستخلص من: `المرحلةالرابعةالتكاملوالاختبار..md`)

## 5. الاختبار الشامل

تُعد الاختبارات جزءًا لا يتجزأ من هذه المرحلة لضمان جودة الأداة واستقرارها وأدائها.

### 5.1. اختبار الوحدة (Unit Testing)

**التعليمات:** قم بكتابة اختبارات وحدة شاملة لكل دالة، مكون واجهة مستخدم، أو وحدة في محرك الترجمة ونظام التقاط الصوت. استخدم إطار عمل اختبار (مثل Jest أو Vitest).

**عدد الملفات المتوقعة:** 20-30 ملفًا (ملف اختبار لكل مكون رئيسي، مثل `src/core/translation/engines/googleTranslate.test.ts`, `src/popup/App.test.tsx`). (مستخلص من: `المرحلةالرابعةالتكاملوالاختبار..md`)

### 5.2. اختبار التكامل (Integration Testing)

**التعليمات:** قم بتصميم وتنفيذ اختبارات تكامل للتحقق من التفاعل بين المكونات المختلفة. اختبر تدفق البيانات الكامل من اكتشاف الفيديو إلى عرض الترجمة، بما في ذلك التفاعلات بين `Content Script` و `Background Service Worker`.

**عدد الملفات المتوقعة:** 8-12 ملفًا (مثل `src/tests/integration/fullWorkflow.test.ts`, `src/tests/integration/messaging.test.ts`). (مستخلص من: `المرحلةالرابعةالتكاملوالاختبار..md`)

### 5.3. اختبار الأداء (Performance Testing)

**التعليمات:** قم بإجراء اختبارات أداء لتقييم سرعة الأداة، استقرارها، وقدرتها على التعامل مع الأحمال المختلفة. قم بقياس زمن الاستجابة لعمليات الترجمة، الالتقاط، وعرض الواجهة. استخدم أدوات مراقبة الأداء في الوقت الحقيقي.

**عدد الملفات المتوقعة:** 3-5 ملفات (مثل `src/tests/performance/translationSpeed.test.ts`, `src/tests/performance/memoryUsage.test.ts`, `src/utils/performanceMonitor.ts`). (مستخلص من: `المرحلةالرابعةالتكاملوالاختبار..md`)

### 5.4. اختبار الأمان (Security Testing)

**التعليمات:** قم بإجراء اختبارات أمان للبحث عن الثغرات الأمنية ونقاط الضعف. تحقق من فعالية آليات التشفير والمصادقة والتحكم في الوصول. اختبر الصلاحيات والخصوصية.

**عدد الملفات المتوقعة:** 3-5 ملفات (مثل `src/tests/security/encryption.test.ts`, `src/tests/security/permissions.test.ts`). (مستخلص من: `المرحلةالرابعةالتكاملوالاختبار..md`)

## 6. التنفيذ التقني (Technical Implementation)

### التعريفات المطلوبة (Type Definitions):

**التعليمات:** يجب أن تعتمد جميع المكونات على التعريفات الموحدة الموجودة في `src/types/common.ts`. قم بتوسيع هذه التعريفات حسب الحاجة لهذه المرحلة، مع إضافة أي أنواع جديدة ضرورية في ملفات أنواع مخصصة ضمن `src/types/`.

**عدد الملفات المتوقعة:** 0-2 ملف (يتم الاستيراد من `src/types/common.ts`، أو إضافة ملفات مثل `src/types/security.ts` و `src/types/data.ts` إذا لزم الأمر).

```typescript
// أمثلة على التعريفات التي يجب استخدامها/توسيعها من common.ts
import { AppConfig, TranslationRequest, TranslationResult, APIKeyConfig, SyncConfig, DataExportFormat } from '../../types/common';

// تعريفات إضافية قد تكون مطلوبة في هذه المرحلة
export interface SecurityPolicy {
  encryptionAlgorithm: string;
  authenticationMethod: 'JWT' | 'MFA';
  // ... خصائص أخرى
}

export interface TestReport {
  testSuite: string;
  status: 'passed' | 'failed';
  duration: number;
  // ... خصائص أخرى
}
```
(مستخلص من: `المرحلةالرابعةالتكاملوالاختبار..md`)

### الواجهات البرمجية (Interfaces):

*   يجب أن تتوافق جميع المكونات مع الواجهات المحددة في المراحل السابقة.
*   يجب أن تكون واجهات الاختبار واضحة وموحدة.
(مستخلص من: `المرحلةالرابعةالتكاملوالاختبار..md`)

### التكامل مع المكونات الأخرى:

**التعليمات:** يجب أن يتم التأكد من أن جميع المكونات من المراحل السابقة (الإعداد التقني، التصميم المعماري، النواة الأساسية، واجهة المستخدم) تتكامل بسلاسة وتتواصل بشكل فعال. يجب أن تكون هذه المرحلة هي نقطة التحقق النهائية من عمل النظام ككل.

**عدد الملفات المتوقعة:** 0 (هذا يمثل منهجية تصميم وتفاعل بين المكونات). (مستخلص من: `المرحلةالرابعةالتكاملوالاختبار..md`)

### قائمة التدقيق التقني (Technical Checklist):

*   تم تنفيذ نظام رسائل قوي وفعال بين جميع مكونات الإضافة.
*   تم دمج جميع واجهات برمجة التطبيقات الداخلية والخارجية بنجاح.
*   تم تنفيذ آليات إدارة البيانات (التخزين، الاسترجاع، المزامنة، التصدير، الاستيراد).
*   تم تطبيق تدابير أمنية قوية (تشفير، مصادقة، صلاحيات، خصوصية).
*   تم كتابة اختبارات وحدة شاملة لجميع المكونات الرئيسية.
*   تم تنفيذ اختبارات تكامل للتحقق من تدفق البيانات والتفاعل بين المكونات.
*   تم إجراء اختبارات أداء لتقييم السرعة والاستقرار واستهلاك الموارد.
*   تم إجراء اختبارات أمان للبحث عن الثغرات ونقاط الضعف.
*   الكود منظم، قابل للاختبار، ويتبع أفضل الممارسات.
(مستخلص من: `المرحلةالرابعةالتكاملوالاختبار..md`)

**الناتج المطلوب:** مجموعة كاملة من الكود البرمجي الذي يربط جميع المكونات معًا، بالإضافة إلى مجموعة شاملة من الاختبارات (وحدة، تكامل، أداء، أمان) التي تؤكد على جودة واستقرار الأداة. يجب أن يكون كل جزء من الكود والاختبارات موثقًا بشكل جيد. **العدد الإجمالي للملفات البرمجية المتوقعة لهذه المرحلة يتراوح بين 43 إلى 68 ملفًا.** (مستخلص من: `المرحلةالرابعةالتكاملوالاختبار..md`)

---
