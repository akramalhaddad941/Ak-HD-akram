# وحدة التقاط وتحويل الوسائط

تُعد هذه الوحدة مسؤولة عن جميع العمليات المتعلقة بالتقاط الفيديو والصوت من مصادر مختلفة ومعالجتها وتحويلها إلى صيغ قابلة للترجمة أو العرض. تضمن هذه الوحدة مرونة الأداة في التعامل مع أنواع متعددة من الوسائط.

## 1. أهداف الوحدة:

*   التقاط الصوت والفيديو من مصادر متعددة (مثل المتصفح، ملفات محلية، خدمات سحابية).
*   تحويل الكلام إلى نص (Speech-to-Text - STT).
*   تحويل النص إلى كلام (Text-to-Speech - TTS) لإعادة الدبلجة.
*   معالجة وتنسيق الترجمات المصاحبة (Subtitles).
*   دعم صيغ متعددة للفيديو والصوت.

## 2. المكونات الرئيسية:

### 2.1. التقاط الوسائط (Media Capture):

*   **`BrowserCaptureService`:** لالتقاط الصوت مباشرة من تبويب المتصفح أو من عنصر الفيديو باستخدام Web Audio API أو Desktop Capture API. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`, `استراتيجياتالوصولوالترجمة.md`)
*   **`FileProcessingService`:** لمعالجة ملفات الفيديو والصوت المحلية التي يرفعها المستخدم. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)
*   **`CloudIntegrationService`:** للوصول إلى ملفات الفيديو المخزنة في خدمات سحابية مثل Google Drive أو Dropbox عبر واجهات برمجة التطبيقات الخاصة بهم. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`, `استراتيجياتالوصولوالترجمة.md`)

### 2.2. تحويل الكلام إلى نص (Speech-to-Text - STT):

*   **`STTProviderInterface`:** واجهة موحدة للتعامل مع مختلف محركات STT. (مستخلص من: `دمجمميزاتنظامالخبراءوالترجمةوsttكاملة.md`)
*   **`WhisperAIAdapter`:** محول خاص بخدمة OpenAI Whisper. (مستخلص من: `دمجمميزاتنظامالخبراءوالترجمةوsttكاملة.md`)
*   **`GoogleSTTAdapter`:** محول خاص بخدمة Google Cloud Speech-to-Text. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)
*   **`LocalSTTModel`:** دعم لنماذج STT التي تعمل محليًا على جهاز المستخدم لضمان الخصوصية والسرعة. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)
*   **`DiarizationService`:** خدمة للتعرف على المتحدثين المختلفين في الفيديو. (مستخلص من: `استراتيجياتالوصولوالترجمة.md`)

### 2.3. تحويل النص إلى كلام (Text-to-Speech - TTS):

*   **`TTSProviderInterface`:** واجهة موحدة للتعامل مع مختلف محركات TTS.
*   **`GoogleTTSAdapter`:** محول خاص بخدمة Google Cloud Text-to-Speech.
*   **`AzureTTSAdapter`:** محول خاص بخدمة Microsoft Azure Text-to-Speech.
*   **`LocalTTSModel`:** دعم لنماذج TTS التي تعمل محليًا.

### 2.4. معالجة الترجمات (Subtitle Processing):

*   **`SubtitleParser`:** لتحليل ملفات الترجمة الموجودة (مثل SRT, VTT) واستخراج النصوص والتوقيتات. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)
*   **`SubtitleGenerator`:** لتوليد ملفات ترجمة جديدة بناءً على النصوص المترجمة والتوقيتات. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)
*   **`TimingAdjuster`:** لضبط توقيتات الترجمات لمزامنتها بدقة مع الفيديو. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)

## 3. الاعتبارات التقنية:

*   **الأداء:** يجب أن تكون عمليات الالتقاط والتحويل سريعة وفعالة لتوفير تجربة مستخدم سلسة.
*   **الموثوقية:** ضمان دقة عمليات STT و TTS.
*   **قابلية التوسع:** سهولة إضافة محركات STT و TTS جديدة.
*   **التعامل مع الأخطاء:** آليات قوية للتعامل مع أخطاء API ومشكلات الشبكة.
*   **الخصوصية:** معالجة البيانات الصوتية والنصية بشكل آمن، مع توفير خيارات للمعالجة المحلية.

## 4. التنفيذ التقني (Technical Implementation):

### التعريفات المطلوبة (Type Definitions):

*   يجب أن تعتمد جميع المكونات على التعريفات الموحدة الموجودة في `src/types/common.ts`.
*   قم بتوسيع هذه التعريفات حسب الحاجة لهذه المرحلة، مع إضافة أي أنواع جديدة ضرورية في ملفات أنواع مخصصة ضمن `src/types/`.

```typescript
// أمثلة على التعريفات التي يجب استخدامها/توسيعها من common.ts
import { AudioStream, VideoStream, STTResult, TTSConfig } from '../../types/common';

// تعريفات إضافية قد تكون مطلوبة في هذه الوحدة
export interface MediaCaptureConfig {
  source: 'browser' | 'file' | 'cloud';
  audioInputDevice?: string;
  videoInputDevice?: string;
}

export interface SubtitleEntry {
  id: number;
  start: number;
  end: number;
  text: string;
}
```

### قائمة التدقيق التقني (Technical Checklist):

*   تم تنفيذ خدمة لالتقاط الصوت من المتصفح.
*   تم دمج محركات STT متعددة (سحابية ومحلية).
*   تم دمج محركات TTS متعددة (سحابية ومحلية).
*   تم تطوير أدوات لتحليل وتوليد ملفات الترجمة.
*   تم التعامل مع الأداء والموثوقية وقابلية التوسع.

**الناتج المطلوب:** وحدة متكاملة وقوية لالتقاط ومعالجة وتحويل الوسائط، تدعم مصادر وصيغ متعددة، وتوفر خدمات STT و TTS عالية الجودة. **العدد الإجمالي للملفات البرمجية المتوقعة لهذه الوحدة يتراوح بين 15 إلى 25 ملفًا.**

---
