# مدير محركات الترجمة (Translation Engine Manager)

مدير محركات الترجمة هو مكون أساسي في نظام محركات الترجمة المتعددة، وهو مسؤول عن اكتشاف، تسجيل، تكوين، وإدارة جميع محركات الترجمة المتاحة. يضمن هذا المدير أن النظام لديه رؤية واضحة لقدرات كل محرك، مما يسهل على وحدة اختيار المحرك الذكي اتخاذ القرارات الصحيحة.

## الغرض والأهداف

*   **اكتشاف المحركات**: تحديد محركات الترجمة المتاحة (سواء كانت خارجية مثل Google Translate أو داخلية مثل الخبراء المتخصصين).
*   **التكوين المركزي**: توفير مكان مركزي لتكوين كل محرك ترجمة، بما في ذلك مفاتيح API، الحدود القصوى للمعدل (Rate Limits)، واللغات المدعومة.
*   **إدارة الحالة**: تتبع حالة كل محرك (نشط، غير نشط، يواجه مشاكل) لضمان توجيه الطلبات فقط إلى المحركات العاملة.
*   **قابلية التوسع**: تسهيل إضافة محركات ترجمة جديدة أو إزالة القديمة دون الحاجة إلى تعديلات كبيرة في الكود الأساسي.

## المكونات الرئيسية للمدير

1.  **سجل المحركات (Engine Registry)**:
    *   قاعدة بيانات أو كائن تخزين يحتوي على معلومات مفصلة حول كل محرك ترجمة.
    *   تشمل هذه المعلومات: اسم المحرك، نوعه (خارجي، داخلي، متخصص)، اللغات المدعومة، مفاتيح API، نقاط النهاية، وأي إعدادات خاصة.

2.  **وحدة التهيئة (Initialization Unit)**:
    *   مسؤولة عن تحميل وتكوين جميع محركات الترجمة عند بدء تشغيل النظام.
    *   تقوم بالتحقق من صحة مفاتيح API والاتصال الأولي بالمحركات الخارجية.

3.  **وحدة المراقبة (Monitoring Unit)**:
    *   تراقب أداء وصحة كل محرك ترجمة بشكل دوري.
    *   تسجل الأخطاء، أوقات الاستجابة، ومعدلات النجاح لتقديم رؤى حول موثوقية المحرك.

4.  **وحدة التجريد (Abstraction Unit)**:
    *   توفر واجهة موحدة للتفاعل مع كل محرك ترجمة، بغض النظر عن تفاصيله الداخلية.
    *   تضمن أن جميع المحركات تلتزم بعقد (Interface) موحد للترجمة.

## آلية العمل

1.  **التسجيل**: عند بدء تشغيل النظام، يقوم مدير المحركات بتسجيل جميع محركات الترجمة المحددة في ملفات التكوين أو قاعدة البيانات.
2.  **التهيئة**: لكل محرك مسجل، يقوم المدير بتهيئته، وتحميل مفاتيح API الخاصة به، وإجراء أي إعدادات أولية.
3.  **التوفر**: يحتفظ المدير بقائمة بالمحركات المتاحة والجاهزة للاستخدام، مع تحديث حالتها بناءً على المراقبة.
4.  **التوجيه**: عندما تطلب `وحدة اختيار المحرك الذكي` محركًا، يوفر المدير معلومات حول المحركات المتاحة وقدراتها.

## التنفيذ التقني (مثال)

```typescript
// src/interfaces/translationEngine.ts
export interface TranslationEngineConfig {
  name: string;
  type: 'external' | 'internal' | 'expert';
  supportedLanguages: { source: string[], target: string[] };
  apiKey?: string; // Optional for internal/expert engines
  endpoint?: string;
  rateLimit?: number; // Requests per second/minute
  priority?: number; // Higher number means higher priority
  domainCapabilities?: string[]; // e.g., ['medical', 'legal']
}

export interface ITranslationEngine {
  config: TranslationEngineConfig;
  translate(text: string, sourceLang: string, targetLang: string, domain?: string): Promise<string>;
  getStatus(): 'active' | 'inactive' | 'degraded';
}

// src/services/engineManager.ts
import { ITranslationEngine, TranslationEngineConfig } from '../interfaces/translationEngine';

// Dummy implementations for external engines
class GoogleTranslateEngine implements ITranslationEngine {
  config: TranslationEngineConfig;
  constructor(config: TranslationEngineConfig) { this.config = config; }
  async translate(text: string, sourceLang: string, targetLang: string): Promise<string> {
    console.log(`Translating with Google: ${text} from ${sourceLang} to ${targetLang}`);
    // Simulate API call
    return `Translated by Google: ${text}`;
  }
  getStatus(): 'active' | 'inactive' | 'degraded' { return 'active'; }
}

class DeepLEngine implements ITranslationEngine {
  config: TranslationEngineConfig;
  constructor(config: TranslationEngineConfig) { this.config = config; }
  async translate(text: string, sourceLang: string, targetLang: string): Promise<string> {
    console.log(`Translating with DeepL: ${text} from ${sourceLang} to ${targetLang}`);
    // Simulate API call
    return `Translated by DeepL: ${text}`;
  }
  getStatus(): 'active' | 'inactive' | 'degraded' { return 'active'; }
}

// Assume ExpertTranslationEngine is defined elsewhere and implements ITranslationEngine
// import { ExpertTranslationEngine } from './expertTranslationEngine';

class EngineManager {
  private engines: Map<string, ITranslationEngine> = new Map();

  constructor() {
    this.loadEngines();
  }

  private loadEngines() {
    // Load configurations from a file, database, or environment variables
    const engineConfigs: TranslationEngineConfig[] = [
      {
        name: 'GoogleTranslate',
        type: 'external',
        supportedLanguages: { source: ['en', 'ar'], target: ['en', 'ar'] },
        apiKey: 'YOUR_GOOGLE_API_KEY',
        endpoint: 'https://translation.googleapis.com/language/translate/v2',
        priority: 10,
      },
      {
        name: 'DeepL',
        type: 'external',
        supportedLanguages: { source: ['en', 'ar'], target: ['en', 'ar'] },
        apiKey: 'YOUR_DEEPL_API_KEY',
        endpoint: 'https://api-free.deepl.com/v2/translate',
        priority: 15,
      },
      // Example for an internal expert engine
      {
        name: 'MedicalExpert',
        type: 'expert',
        supportedLanguages: { source: ['en', 'ar'], target: ['en', 'ar'] },
        domainCapabilities: ['medical'],
        priority: 20,
      },
    ];

    engineConfigs.forEach(config => {
      if (config.name === 'GoogleTranslate') {
        this.engines.set(config.name, new GoogleTranslateEngine(config));
      } else if (config.name === 'DeepL') {
        this.engines.set(config.name, new DeepLEngine(config));
      } else if (config.name === 'MedicalExpert') {
        // this.engines.set(config.name, new ExpertTranslationEngine(config));
        // For now, use a dummy for expert
        this.engines.set(config.name, { 
            config: config, 
            translate: async (t, sl, tl, d) => `Translated by MedicalExpert: ${t}`, 
            getStatus: () => 'active' 
        });
      }
      // Add other engine types here
    });
  }

  getEngine(name: string): ITranslationEngine | undefined {
    return this.engines.get(name);
  }

  getAllEngines(): ITranslationEngine[] {
    return Array.from(this.engines.values());
  }

  getAvailableEngines(): ITranslationEngine[] {
    return this.getAllEngines().filter(engine => engine.getStatus() === 'active');
  }
}

export const engineManager = new EngineManager();
```

يضمن مدير محركات الترجمة أن يكون نظام محركات الترجمة المتعددة قويًا، مرنًا، وقابلاً للتوسع، مما يسمح له بالاستفادة من أحدث تقنيات الترجمة الآلية.
