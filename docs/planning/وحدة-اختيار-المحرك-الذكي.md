# وحدة اختيار المحرك الذكي (Intelligent Engine Selection Unit)

تُعد وحدة اختيار المحرك الذكي مكونًا حيويًا في نظام محركات الترجمة المتعددة، حيث تتولى مسؤولية تحديد محرك الترجمة الأنسب لكل طلب ترجمة. تهدف هذه الوحدة إلى تحسين جودة الترجمة، تقليل التكاليف، وزيادة كفاءة النظام من خلال الاستفادة من نقاط القوة الفريدة لكل محرك ترجمة متاح.

## الغرض والأهداف

*   **تحسين الجودة**: اختيار المحرك الذي يقدم أفضل جودة ترجمة لنوع معين من المحتوى أو المجال.
*   **تحسين الكفاءة**: توجيه الطلبات إلى المحركات الأكثر كفاءة من حيث السرعة والتكلفة، مع الأخذ في الاعتبار اللغات والمجالات.
*   **المرونة**: التكيف مع التغيرات في توفر المحركات أو أدائها، واختيار بدائل عند الضرورة.
*   **التخصيص**: السماح بتحديد أولويات اختيار المحرك بناءً على تفضيلات المستخدم أو متطلبات المشروع.

## معايير الاختيار

تعتمد وحدة اختيار المحرك الذكي على مجموعة من المعايير لاتخاذ قرار الاختيار:

1.  **زوج اللغات (Language Pair)**:
    *   التحقق من أن المحرك يدعم اللغتين المصدر والهدف المطلوبتين.
    *   بعض المحركات تتفوق في أزواج لغوية معينة.

2.  **المجال والتخصص (Domain & Specialization)**:
    *   تحليل المحتوى المدخل لتحديد مجاله (طبي، قانوني، تقني، إلخ).
    *   تفضيل المحركات أو الخبراء المتخصصين في هذا المجال (بالتكامل مع نظام إدارة الخبراء).

3.  **جودة المحرك (Engine Quality)**:
    *   الاستفادة من سجلات الأداء التاريخية لتقييم جودة مخرجات كل محرك في سياقات مماثلة.
    *   يمكن أن يتضمن ذلك مقاييس مثل BLEU Score أو تقييمات بشرية سابقة.

4.  **التكلفة (Cost)**:
    *   مراعاة التكلفة المرتبطة باستخدام كل محرك، خاصة للمحركات الخارجية التي تفرض رسومًا.
    *   يمكن تحديد عتبات تكلفة أو تفضيلات للمستخدم.

5.  **السرعة/وقت الاستجابة (Speed/Latency)**:
    *   تفضيل المحركات التي تقدم ترجمات أسرع عندما يكون الوقت عاملاً حاسمًا.
    *   الاستفادة من بيانات وقت الاستجابة من `قاعدة-بيانات-سجلات-الأداء.md`.

6.  **توفر المحرك (Engine Availability)**:
    *   التحقق من حالة المحرك الحالية (نشط، غير نشط، متدهور) من `مدير-محركات-الترجمة.md`.
    *   تجنب المحركات غير المتاحة أو التي تواجه مشاكل.

7.  **تفضيلات المستخدم (User Preferences)**:
    *   السماح للمستخدمين بتحديد محرك مفضل أو تحديد أولويات معينة (مثل الأولوية للجودة على التكلفة).

## آلية العمل

1.  **تحليل الطلب**: تتلقى الوحدة طلب ترجمة من `واجهة-برمجة-التطبيقات-الموحدة.md`، وتقوم بتحليل النص، اللغات، والمجال.
2.  **جمع معلومات المحرك**: تستعلم الوحدة من `مدير-محركات-الترجمة.md` عن قائمة المحركات المتاحة وحالتها وقدراتها.
3.  **تطبيق معايير الاختيار**: تقوم الوحدة بتصفية المحركات بناءً على زوج اللغات والمجال، ثم تقوم بترتيب المحركات المتبقية بناءً على معايير مثل الجودة، التكلفة، والسرعة.
4.  **اختيار المحرك الأمثل**: يتم اختيار المحرك الأعلى تصنيفًا أو الأنسب بناءً على خوارزمية الاختيار.
5.  **إرجاع المحرك المختار**: يتم إرجاع المحرك المختار إلى `وحدة الترجمة الهجينة والمعالجة اللاحقة` أو مباشرة إلى `واجهة برمجة التطبيقات الموحدة` لتنفيذ الترجمة.

## التنفيذ التقني (مثال)

```typescript
// src/services/intelligentEngineSelectionUnit.ts
import { TranslationRequest } from '../interfaces/translation';
import { ITranslationEngine } from '../interfaces/translationEngine';
import { engineManager } from './engineManager';
import { performanceLogsDB } from './performanceLogsDB'; // Assume a performance logs database exists

export class IntelligentEngineSelectionUnit {
  async selectBestEngine(request: TranslationRequest): Promise<ITranslationEngine> {
    const availableEngines = engineManager.getAvailableEngines();

    // 1. Filter by language pair
    const languageFilteredEngines = availableEngines.filter(engine => 
      engine.config.supportedLanguages.source.includes(request.source_language) &&
      engine.config.supportedLanguages.target.includes(request.target_language)
    );

    if (languageFilteredEngines.length === 0) {
      throw new Error(`No engine supports language pair ${request.source_language}-${request.target_language}`);
    }

    // 2. Score engines based on various criteria
    const scoredEngines = await Promise.all(languageFilteredEngines.map(async engine => {
      let score = 0;

      // Prioritize expert engines for specific domains
      if (request.domain && engine.config.domainCapabilities?.includes(request.domain)) {
        score += 100; // High priority for domain-specific experts
      }

      // Add score based on historical quality (from performanceLogsDB)
      const historicalPerformance = await performanceLogsDB.getEngineAverageQuality(engine.config.name, request.domain);
      if (historicalPerformance) {
        score += historicalPerformance * 0.5; // Scale quality score
      }

      // Factor in speed (lower latency is better, so subtract from score or use inverse)
      const avgLatency = await performanceLogsDB.getEngineAverageLatency(engine.config.name);
      if (avgLatency) {
        score -= avgLatency * 0.1; // Lower latency -> higher score
      }

      // Factor in user preferences (e.g., quality_preference)
      if (request.quality_preference === 'high' && engine.config.priority) {
        score += engine.config.priority; // Engines with higher priority for quality get more points
      }
      // Add logic for 'fast' preference etc.

      return { engine, score };
    }));

    // Sort by score in descending order
    scoredEngines.sort((a, b) => b.score - a.score);

    if (scoredEngines.length === 0) {
      throw new Error('No suitable engine found after scoring.');
    }

    return scoredEngines[0].engine;
  }
}

export const intelligentEngineSelectionUnit = new IntelligentEngineSelectionUnit();
```

تضمن هذه الوحدة أن يتم توجيه كل طلب ترجمة إلى المحرك الأكثر ملاءمة، مما يؤدي إلى تحسين كبير في جودة الترجمة الكلية وكفاءة النظام.
