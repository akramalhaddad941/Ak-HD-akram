# واجهة برمجة التطبيقات الموحدة (Unified API Interface)

تُعد واجهة برمجة التطبيقات الموحدة (Unified API Interface) حجر الزاوية في نظام محركات الترجمة المتعددة، حيث توفر نقطة دخول واحدة وموحدة للتعامل مع جميع محركات الترجمة المدعومة، بغض النظر عن تعقيداتها أو اختلافات واجهاتها الأصلية. تهدف هذه الواجهة إلى تبسيط عملية التكامل للمطورين، وتقليل الجهد اللازم للتفاعل مع خدمات الترجمة المتنوعة.

## الغرض والأهداف

*   **التبسيط والتجريد**: تجريد تعقيدات محركات الترجمة المختلفة (مثل Google Translate, DeepL, Microsoft Translator) خلف واجهة واحدة نظيفة وموحدة.
*   **المرونة وقابلية التوسع**: السماح بإضافة محركات ترجمة جديدة أو إزالة الموجودة دون التأثير على الكود الأساسي للتطبيق.
*   **الاتساق**: ضمان تجربة تطوير متسقة عبر جميع خدمات الترجمة، بغض النظر عن المحرك الفعلي المستخدم.
*   **تحسين الإنتاجية**: تمكين المطورين من التركيز على منطق العمل الأساسي بدلاً من التعامل مع الفروقات الدقيقة لكل محرك ترجمة.

## المكونات الرئيسية للواجهة

تتكون الواجهة الموحدة عادةً من العناصر التالية:

1.  **نقطة نهاية موحدة (Unified Endpoint)**:
    *   عنوان URL واحد يتم من خلاله إرسال جميع طلبات الترجمة.
    *   مثال: `/api/v1/translate`.

2.  **نموذج طلب موحد (Standardized Request Model)**:
    *   تنسيق JSON موحد لجميع طلبات الترجمة، يتضمن حقولاً مثل: `text` (النص المراد ترجمته)، `source_language`، `target_language`، `domain` (المجال المتخصص)، `quality_preference` (تفضيل الجودة)، وغيرها.

3.  **نموذج استجابة موحد (Standardized Response Model)**:
    *   تنسيق JSON موحد لجميع استجابات الترجمة، يتضمن حقولاً مثل: `translated_text`، `engine_used` (المحرك الذي تم استخدامه للترجمة)، `quality_score` (درجة الجودة)، `errors` (أي أخطاء).

4.  **معالجة الأخطاء الموحدة (Standardized Error Handling)**:
    *   نظام موحد للإبلاغ عن الأخطاء، مما يسهل على المطورين معالجة المشكلات بغض النظر عن مصدرها.

## آلية العمل

عندما يتلقى النظام طلب ترجمة عبر الواجهة الموحدة، فإنه يقوم بالخطوات التالية:

1.  **التحقق من صحة الطلب**: التأكد من أن الطلب يتبع النموذج المحدد وأن جميع الحقول المطلوبة موجودة وصحيحة.
2.  **تحليل الطلب**: استخراج المعلومات الأساسية مثل النص، اللغات، والمجال.
3.  **اختيار المحرك**: تمرير الطلب إلى `وحدة اختيار المحرك الذكي` لتحديد محرك الترجمة الأنسب.
4.  **تحويل الطلب**: تحويل الطلب الموحد إلى التنسيق الخاص بالمحرك المختار.
5.  **إرسال الطلب**: إرسال الطلب إلى محرك الترجمة الفعلي.
6.  **استقبال الاستجابة**: استقبال الاستجابة من محرك الترجمة.
7.  **تحويل الاستجابة**: تحويل الاستجابة الخاصة بالمحرك إلى نموذج الاستجابة الموحد.
8.  **إرجاع الاستجابة**: إرجاع الاستجابة الموحدة إلى العميل.

## التنفيذ التقني (مثال)

```typescript
// src/interfaces/translation.ts
export interface TranslationRequest {
  text: string;
  source_language: string;
  target_language: string;
  domain?: string; // e.g., 'medical', 'legal', 'technical'
  quality_preference?: 'high' | 'standard' | 'fast';
  // Add other relevant parameters like 'expert_id' if applicable
}

export interface TranslationResponse {
  translated_text: string;
  engine_used: string; // e.g., 'GoogleTranslate', 'DeepL', 'CustomExpert'
  quality_score?: number; // Optional quality score from 0-100
  errors?: string[];
}

// src/services/unifiedTranslationService.ts
import { TranslationRequest, TranslationResponse } from '../interfaces/translation';
import { engineManager } from './engineManager'; // Assume an engine manager exists

export class UnifiedTranslationService {
  async translate(request: TranslationRequest): Promise<TranslationResponse> {
    // 1. Validate request
    if (!request.text || !request.source_language || !request.target_language) {
      throw new Error('Missing required translation parameters.');
    }

    // 2. Select the best engine based on request parameters
    const selectedEngine = engineManager.selectEngine(request);

    // 3. Transform request to the selected engine's format and call it
    const engineResponse = await selectedEngine.translate(request);

    // 4. Transform engine response to unified format and return
    return {
      translated_text: engineResponse.translatedText,
      engine_used: selectedEngine.name,
      quality_score: engineResponse.qualityScore,
      errors: engineResponse.errors,
    };
  }
}
```

تضمن هذه الواجهة أن يتمكن المطورون من التفاعل مع نظام الترجمة المتعددة بكفاءة وفعالية، مع الاستفادة الكاملة من مرونة وقوة المحركات المتنوعة.
