# المرحلة 02: تطوير النواة الأساسية

تركز هذه المرحلة على بناء المكونات الأساسية لأداة ترجمة الفيديو، والتي تشمل نظام الترجمة، نظام التقاط الصوت، ونظام إدارة البيانات. تهدف إلى إنشاء أساس وظيفي قوي للأداة.

## 1. تطوير نظام الترجمة الأساسي:

### 1.1. محرك الترجمة (Translation Engine):

*   **Translation Orchestrator:** المكون المركزي الذي يدير عملية الترجمة. يجب أن يكون قادرًا على تنسيق العمليات بين مختلف محركات الترجمة. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   **Engine Router:** يوجه طلبات الترجمة إلى المحرك المناسب بناءً على إعدادات المستخدم أو توفر المحرك. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   **Fallback Manager:** يدير المحركات الاحتياطية في حال فشل المحرك الأساسي أو عدم توفره. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   **Cache Layer:** لتخزين الترجمات مؤقتًا لتقليل زمن الاستجابة وتحسين الأداء. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   **Quality Assessor:** (ميزة متقدمة) لتقييم جودة الترجمة وتقديم ملاحظات. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   **API Manager:** لإدارة واجهات برمجة التطبيقات الخاصة بمحركات الترجمة المختلفة. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)

**التعليمات:**
*   قم بتطوير `Translation Orchestrator` ليكون قادرًا على التعامل مع أنواع مختلفة من محركات الترجمة. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   استخدم `TranslationRequest` و `TranslationResult` من `src/types/common.ts` لتوحيد صيغ البيانات. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   قم بتنفيذ `Engine Router` الذي يختار المحرك بناءً على `TranslationEngineConfig`. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   يجب أن يدعم النظام محركات ترجمة مجانية ومدفوعة ومحلية. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)

**عدد الملفات المتوقعة:** 10-15 ملفًا (مثل `src/core/translation/TranslationOrchestrator.ts`, `src/core/translation/EngineRouter.ts`, `src/core/translation/engines/GoogleTranslateEngine.ts`, `src/core/translation/engines/LibreTranslateEngine.ts`, `src/core/translation/TranslationCache.ts`).

## 2. تطوير نظام التقاط الصوت وتحويله إلى نص (STT):

### 2.1. نظام التقاط الصوت (Audio Capture System):

*   **Audio Capture Manager:** يدير عملية الالتقاط من مصادر مختلفة. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   **Capture Strategies:** تتضمن الالتقاط المباشر من الفيديو، التقاط التبويب، التقاط مستوى النظام، والميكروفون. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   **Audio Processor:** لمعالجة الصوت (تقليل الضوضاء، تطبيع الصوت، تحويل الصيغ). (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)

### 2.2. محرك تحويل الكلام إلى نص (STT Engine):

*   **STT Engine:** لتحويل الكلام إلى نص (مثل OpenAI Whisper، Mozilla DeepSpeech، Vosk). (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)

**التعليمات:**
*   قم بتطوير `Audio Capture Manager` باستخدام Web Audio API لالتقاط الصوت. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   قم بتنفيذ `Audio Processor` الذي يستخدم FFmpeg.wasm لتحويل صيغ الصوت. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   دمج محركات STT المختلفة، مع دعم النماذج المحلية باستخدام TensorFlow.js. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   يجب أن يستخدم النظام `AudioSegment` و `STTResult` من `src/types/common.ts`. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)

**عدد الملفات المتوقعة:** 8-12 ملفًا (مثل `src/core/audio/AudioCaptureManager.ts`, `src/core/audio/AudioProcessor.ts`, `src/core/audio/stt/WhisperSTTEngine.ts`, `src/core/audio/stt/VoskSTTEngine.ts`).

## 3. تطوير نظام إدارة البيانات (Data Management):

### 3.1. قواعد البيانات:

*   **`Settings DB`:** لتفضيلات المستخدم، إعدادات المحركات، وإعدادات الواجهة. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   **`Translation Archive`:** لتخزين الترجمات، مقاطع الصوت، والبيانات الوصفية. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   **`Cache DB`:** للتخزين المؤقت للترجمات والصوت والنماذج. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)

### 3.2. تقنيات التخزين:

*   **IndexedDB:** للأرشيف والبيانات الكبيرة. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   **Chrome Storage:** للإعدادات والمعلومات الأساسية. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   **Local Cache:** للتخزين المؤقت السريع. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)

**التعليمات:**
*   قم بتصميم وتنفيذ هياكل قواعد البيانات الثلاثة المذكورة. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   استخدم IndexedDB و Chrome Storage API لتنفيذ آليات التخزين والاسترجاع. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   يجب أن يدعم النظام `AppConfig`, `TranslationEntry`, `AudioEntry` من `src/types/common.ts`. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)

**عدد الملفات المتوقعة:** 5-7 ملفات (مثل `src/data/SettingsDB.ts`, `src/data/TranslationArchiveDB.ts`, `src/data/CacheDB.ts`, `src/data/StorageManager.ts`).

## 4. واجهات برمجة التطبيقات الداخلية (Internal APIs):

*   **Translation API:** لوظائف الترجمة واكتشاف اللغة. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   **Audio API:** لالتقاط ومعالجة الصوت وتحويله إلى نص. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   **Storage API:** لحفظ واسترجاع وتصدير البيانات. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)

**التعليمات:**
*   قم بتطوير هذه الواجهات لتسهيل التواصل بين المكونات الداخلية للأداة. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)

**عدد الملفات المتوقعة:** 3 ملفات (مثل `src/api/TranslationAPI.ts`, `src/api/AudioAPI.ts`, `src/api/StorageAPI.ts`).

## 5. التنفيذ التقني (Technical Implementation):

### التعريفات المطلوبة (Type Definitions):

*   يجب أن تعتمد جميع المكونات على التعريفات الموحدة الموجودة في `src/types/common.ts`. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)
*   قم بتوسيع هذه التعريفات حسب الحاجة لهذه المرحلة، مع إضافة أي أنواع جديدة ضرورية في ملفات أنواع مخصصة ضمن `src/types/`. (مستخلص من: `المرحلةالثانيةتطويرالنواةالأساسية..md`)

```typescript
// أمثلة على التعريفات التي يجب استخدامها/توسيعها من common.ts
import { AppConfig, TranslationRequest, TranslationResult, AudioSegment, STTResult } from "../../types/common";

// تعريفات إضافية قد تكون مطلوبة في هذه المرحلة
export interface TranslationEngineConfig {
  id: string;
  name: string;
  apiKey?: string;
  // ... خصائص أخرى
}

export interface STTEngineConfig {
  id: string;
  name: string;
  modelPath?: string;
  // ... خصائص أخرى
}
```

### قائمة التدقيق التقني (Technical Checklist):

*   تم تنفيذ `Translation Orchestrator` و `Engine Router` بشكل فعال.
*   تم دمج محركات ترجمة متعددة (مجانية ومدفوعة ومحلية).
*   تم تطوير `Audio Capture Manager` و `Audio Processor`.
*   تم دمج محركات STT متعددة مع دعم النماذج المحلية.
*   تم تصميم وتنفيذ هياكل قواعد البيانات (`Settings DB`, `Translation Archive`, `Cache DB`).
*   تم استخدام IndexedDB و Chrome Storage API بشكل صحيح.
*   تم تطوير `Translation API`, `Audio API`, `Storage API` الداخلية.
*   الكود منظم، قابل للاختبار، ويتبع أفضل الممارسات.

**الناتج المطلوب:** كود برمجي وظيفي لجميع مكونات النواة الأساسية المذكورة أعلاه. يجب أن يكون الكود منظمًا، قابلًا للاختبار، ويتبع أفضل الممارسات في تطوير الواجهة الخلفية والمنطق. يجب أن يكون كل جزء من الكود موثقًا بشكل جيد، مع أمثلة على كيفية استخدامه. يجب أن تكون النواة جاهزة للتكامل مع واجهة المستخدم في المرحلة التالية. **العدد الإجمالي للملفات البرمجية المتوقعة لهذه المرحلة يتراوح بين 26 إلى 37 ملفًا.**

---
