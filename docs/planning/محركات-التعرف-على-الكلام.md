# محركات التعرف على الكلام (Speech Recognition Engines)

تُعد محركات التعرف على الكلام هي القلب النابض لنظام STT المتقدم، وهي المسؤولة عن تحويل الإشارات الصوتية المعالجة إلى نص مكتوب. يعتمد النظام على استراتيجية دمج المحركات المتعددة (Multi-Engine Strategy) للاستفادة من نقاط القوة المختلفة لكل محرك وضمان أعلى دقة ممكنة.

## الغرض والأهداف

*   **تحويل الصوت إلى نص**: الوظيفة الأساسية هي تحويل المقاطع الصوتية إلى نص مكتوب بدقة عالية.
*   **دعم اللغات واللهجات**: توفير دعم واسع لمجموعة متنوعة من اللغات واللهجات، خاصة اللغة العربية بمختلف تنوعاتها.
*   **التخصصية**: استخدام نماذج لغوية متخصصة (Domain-Specific Language Models) لتحسين الدقة في المجالات الفنية والعلمية.
*   **المرونة**: السماح بالتبديل السلس بين المحركات المختلفة بناءً على جودة الصوت، اللغة، والتكلفة.

## أنواع المحركات المدعومة

يدعم النظام دمج أنواع مختلفة من محركات STT:

1.  **محركات STT التجارية (Commercial STT Engines)**:
    *   **أمثلة**: Google Speech-to-Text, Microsoft Azure Speech, Amazon Transcribe.
    *   **المميزات**: دقة عالية في اللغات الشائعة، دعم واسع، تحديث مستمر.
    *   **الاستخدام**: تُستخدم كخيار أساسي للتحويل النصي العام وعالي الجودة.

2.  **محركات STT مفتوحة المصدر (Open-Source STT Engines)**:
    *   **أمثلة**: Whisper (OpenAI), Mozilla DeepSpeech.
    *   **المميزات**: تكلفة منخفضة، إمكانية التعديل والتدريب المخصص، أداء ممتاز في بعض اللغات.
    *   **الاستخدام**: تُستخدم في السيناريوهات التي تتطلب تخصيصًا عميقًا أو للغات التي قد لا تدعمها المحركات التجارية بشكل جيد.

3.  **نماذج STT المتخصصة الداخلية (Internal Specialized STT Models)**:
    *   **أمثلة**: نماذج تم تدريبها داخليًا على بيانات خاصة بالمجال (مثل المصطلحات الطبية أو القانونية).
    *   **المميزات**: دقة قصوى في المجالات المتخصصة، تحكم كامل في الأداء.
    *   **الاستخدام**: تُستخدم عندما يتطلب المحتوى دقة عالية للمصطلحات الفنية.

## آلية العمل

1.  **استقبال المقاطع الصوتية**: تتلقى المحركات المقاطع الصوتية المعالجة مسبقًا من `وحدة-معالجة-الصوت-المسبقة.md`.
2.  **اختيار المحرك**: يتم اختيار المحرك الأنسب لكل مقطع صوتي بناءً على اللغة، المجال، وجودة الصوت. يمكن استخدام استراتيجية الترجمة الهجينة حيث يتم إرسال نفس المقطع إلى عدة محركات ومقارنة النتائج.
3.  **التحويل النصي**: يقوم المحرك المختار بتحويل المقطع الصوتي إلى نص.
4.  **إخراج النص المؤقت**: يتم إخراج النص مع الطوابع الزمنية (Timestamps) لكل كلمة أو جملة.

## التنفيذ التقني (مثال)

```typescript
// src/interfaces/sttEngine.ts
export interface STTResult {
  text: string;
  confidence: number; // Confidence score from 0 to 1
  timestamps: { word: string, start: number, end: number }[];
  engineUsed: string;
}

export interface ISTTEngine {
  name: string;
  supportsLanguage(languageCode: string): boolean;
  transcribe(audioSegment: Buffer, languageCode: string, domain?: string): Promise<STTResult>;
}

// src/services/sttEngineManager.ts (Simplified)
class WhisperEngine implements ISTTEngine {
  name = 'Whisper';
  supportsLanguage(languageCode: string): boolean { return true; /* Whisper supports many languages */ }
  async transcribe(audioSegment: Buffer, languageCode: string, domain?: string): Promise<STTResult> {
    console.log(`Transcribing with Whisper for ${languageCode}, domain: ${domain}`);
    // Simulate transcription process
    const simulatedText = "This is a simulated transcription result from Whisper.";
    return {
      text: simulatedText,
      confidence: 0.95,
      timestamps: [], // Simplified for example
      engineUsed: this.name,
    };
  }
}

class GoogleSTTExpert implements ISTTEngine {
  name = 'GoogleSTTExpert';
  supportsLanguage(languageCode: string): boolean { return languageCode === 'ar'; }
  async transcribe(audioSegment: Buffer, languageCode: string, domain?: string): Promise<STTResult> {
    console.log(`Transcribing with Google STT Expert for ${languageCode}, domain: ${domain}`);
    // Simulate transcription with domain-specific model
    const simulatedText = "هذه نتيجة تحويل نصي متخصصة من جوجل.";
    return {
      text: simulatedText,
      confidence: 0.98,
      timestamps: [],
      engineUsed: this.name,
    };
  }
}

export const sttEngines: ISTTEngine[] = [
  new WhisperEngine(),
  new GoogleSTTExpert(),
  // Add other engines here
];

// Logic for selecting the best engine (similar to the translation engine selection unit)
export function selectBestSTTEngine(languageCode: string, domain?: string): ISTTEngine {
  // Simple selection logic: prioritize expert for 'ar'
  const expertEngine = sttEngines.find(e => e.name === 'GoogleSTTExpert' && e.supportsLanguage(languageCode));
  if (expertEngine) return expertEngine;

  // Fallback to a general-purpose engine
  const generalEngine = sttEngines.find(e => e.name === 'Whisper');
  if (generalEngine) return generalEngine;

  throw new Error('No suitable STT engine found.');
}
```

يضمن هذا التنوع في المحركات أن نظام STT المتقدم يمكنه التعامل مع مجموعة واسعة من المدخلات الصوتية بفعالية ودقة عالية، مما يضع أساسًا متينًا لعملية الترجمة اللاحقة.
