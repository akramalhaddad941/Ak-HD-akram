> # نظام التعرف على الكلام والتحويل الصوتي (STT System)

## 1. الوصف العام
يتولى هذا النظام مسؤولية تحويل دفق الصوت الملتقط من الفيديو إلى نص مكتوب بدقة عالية وفي الوقت الفعلي. وهو يمثل المرحلة الأولى والحرجة في عملية الترجمة.

## 2. المكونات الرئيسية

| المكون | الوظيفة | التقنية المقترحة |
| :--- | :--- | :--- |
| **وحدة التقاط الصوت (Audio Capture)** | التقاط دفق الصوت من الفيديو في الوقت الفعلي باستخدام Web Audio API. | Web Audio API |
| **وحدة معالجة الصوت المسبقة** | تنقية الصوت وإزالة الضوضاء وتطبيع مستوى الصوت لزيادة دقة التعرف. | WebAssembly (FFmpeg.wasm) |
| **مدير محركات STT** | إدارة واجهات برمجة التطبيقات لمحركات STT المتعددة (Whisper, Google, Azure). | Service Class |
| **وحدة التخصيص السياقي** | استخدام قائمة كلمات مخصصة (Custom Vocabulary) بناءً على سياق الفيديو لتحسين دقة التعرف. | ميزات التخصيص في API محركات STT |
| **وحدة المعالجة اللاحقة للنص** | تصحيح الأخطاء النحوية والإملائية البسيطة في النص المعترف به قبل إرساله للترجمة. | مكتبات NLP خفيفة الوزن |

## 3. تحديات الأداء والدقة
*   **تحدي الـ Latency**: يجب أن يتم معالجة الصوت وإرساله إلى محرك STT في دفعات صغيرة (Chunks) لتقليل زمن الاستجابة.
*   **تحدي الضوضاء**: يجب أن تكون وحدة معالجة الصوت المسبقة فعالة للغاية في عزل صوت المتحدث عن ضوضاء الخلفية والموسيقى.
*   **تحدي اللهجات**: يجب أن يكون النظام قادرًا على التعامل مع اللهجات المختلفة للغة المصدر.

## 4. المخرجات
*   نص مكتوب (Transcript) مقسم إلى جمل أو عبارات قصيرة (Chunks).
*   تحديد دقيق لزمن بداية ونهاية كل عبارة (Timestamp) لضمان مزامنة العرض مع الفيديو.

# نظام التعرف على الكلام والتحويل الصوتي

يُعد نظام التعرف على الكلام (Speech-to-Text - STT) والتحويل الصوتي (Text-to-Speech - TTS) مكونًا حيويًا في أداة ترجمة الفيديو، حيث يمكنها من تحويل المحتوى الصوتي إلى نص قابل للترجمة، وإعادة تحويل النص المترجم إلى صوت. يهدف هذا النظام إلى توفير دقة عالية ومرونة في التعامل مع اللغات واللهجات المختلفة.

## 1. أهداف النظام:

*   تحويل الكلام المنطوق في الفيديو إلى نص مكتوب بدقة عالية.
*   دعم لغات ولهجات متعددة لعمليات STT و TTS.
*   تحويل النص المترجم إلى كلام منطوق بجودة عالية وأصوات طبيعية.
*   توفير خيارات للمستخدم لاختيار محركات STT و TTS المفضلة.
*   دمج تقنيات التعرف على المتحدث (Speaker Diarization) لتحسين دقة STT.

## 2. المكونات الرئيسية:

### 2.1. مدير محركات STT (STT Engine Manager):

*   **`STTOrchestrator`:** المكون المركزي الذي ينسق بين محركات STT المختلفة، ويختار الأنسب بناءً على الإعدادات واللغة. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`, `دمجمميزاتنظامالخبراءوالترجمةوsttكاملة.md`)
*   **`STTAdapters`:** واجهات موحدة للتعامل مع كل محرك STT على حدة (مثل OpenAI Whisper, Google Cloud Speech-to-Text, نماذج محلية). (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`, `دمجمميزاتنظامالخبراءوالترجمةوsttكاملة.md`)
*   **`APIKeyManager`:** لإدارة وتأمين مفاتيح API الخاصة بالمحركات السحابية. (مستخلص من: `مثالخطةتطويرلمحركاتالترجمة.md` - يُطبق نفس المفهوم هنا)

### 2.2. معالج الصوت (Audio Processor):

*   **`AudioSegmenter`:** لتقسيم تدفق الصوت إلى أجزاء صغيرة للمعالجة الفعالة. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)
*   **`NoiseReducer`:** لتحسين جودة الصوت قبل إرساله إلى محركات STT. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)
*   **`SpeakerDiarizationService`:** لتحديد المتحدثين المختلفين في الفيديو وتخصيص النص لكل متحدث. (مستخلص من: `استراتيجياتالوصولوالترجمة.md`)

### 2.3. مدير محركات TTS (TTS Engine Manager):

*   **`TTSOrchestrator`:** ينسق بين محركات TTS المختلفة لاختيار الصوت واللغة الأنسب. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)
*   **`TTSAdapters`:** واجهات موحدة للتعامل مع كل محرك TTS (مثل Google Cloud Text-to-Speech, Microsoft Azure Text-to-Speech, نماذج محلية). (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)
*   **`VoiceSelector`:** للسماح للمستخدمين باختيار الأصوات واللهجات المفضلة لـ TTS. (مستخلص من: `اعداداتاضافية.md` - ضمن خيارات الصوت)

### 2.4. مزامنة الصوت والنص (Audio-Text Synchronization):

*   **`TimestampAligner`:** لمزامنة النص المحول من STT بدقة مع توقيتات الفيديو. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)
*   **`AudioRenderer`:** لإعادة دمج الصوت المترجم (من TTS) مع الفيديو الأصلي أو كمسار صوتي منفصل. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)

## 3. تدفق عمل STT/TTS (STT/TTS Workflow):

1.  **التقاط الصوت:** يتم التقاط الصوت من الفيديو بواسطة وحدة التقاط الوسائط. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)
2.  **معالجة الصوت:** يقوم `Audio Processor` بتحسين الصوت وتقسيمه. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)
3.  **التعرف على الكلام (STT):** يرسل `STTOrchestrator` مقاطع الصوت إلى محرك STT المختار لتحويلها إلى نص. (مستخلص من: `دمجمميزاتنظامالخبراءوالترجمةوsttكاملة.md`)
4.  **مزامنة النص:** يقوم `TimestampAligner` بمزامنة النص الناتج مع توقيتات الفيديو. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)
5.  **الترجمة:** يتم إرسال النص إلى نظام الترجمة الذكي. (مستخلص من: `الياتنظامالترجمةالشامل_251006_010449.md`)
6.  **التحويل الصوتي (TTS):** يتم إرسال النص المترجم إلى `TTSOrchestrator` لتحويله إلى صوت. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)
7.  **إعادة الدمج:** يقوم `AudioRenderer` بإعادة دمج الصوت المترجم مع الفيديو. (مستخلص من: `ادواتالتقاطالفيديووالصوتوالترجمةوالتحويل_251006_010620.md`)

## 4. التنفيذ التقني (Technical Implementation):

### التعريفات المطلوبة (Type Definitions):

*   يجب أن تعتمد جميع المكونات على التعريفات الموحدة الموجودة في `src/types/common.ts`.
*   قم بتوسيع هذه التعريفات حسب الحاجة لهذه المرحلة، مع إضافة أي أنواع جديدة ضرورية في ملفات أنواع مخصصة ضمن `src/types/`.

```typescript
// أمثلة على التعريفات التي يجب استخدامها/توسيعها من common.ts
import { AudioData, STTConfig, TTSConfig, LanguageCode } from "../../types/common";

// تعريفات إضافية قد تكون مطلوبة في هذا النظام
export interface STTResult {
  text: string;
  confidence: number;
  timestamps: { start: number; end: number; word: string }[];
}

export interface TTSVoice {
  name: string;
  language: LanguageCode;
  gender: 'male' | 'female';
  style: 'standard' | 'neural';
}
```

### قائمة التدقيق التقني (Technical Checklist):

*   تم تصميم وتنفيذ `STTOrchestrator` و `TTSOrchestrator`.
*   تم تطوير محولات لدمج محركات STT و TTS متعددة.
*   تم دمج مكونات `Audio Processor` و `Speaker Diarization Service`.
*   تم تنفيذ `TimestampAligner` و `AudioRenderer` لمزامنة وإعادة دمج الصوت.
*   تم توفير واجهة لاختيار الأصوات واللهجات لـ TTS.

**الناتج المطلوب:** نظام متكامل للتعرف على الكلام والتحويل الصوتي، يقدم دقة عالية ومرونة في التعامل مع المحتوى الصوتي، ويدعم مجموعة واسعة من اللغات والأصوات. **العدد الإجمالي للملفات البرمجية المتوقعة لهذه الوحدة يتراوح بين 15 إلى 25 ملفًا.**

---
