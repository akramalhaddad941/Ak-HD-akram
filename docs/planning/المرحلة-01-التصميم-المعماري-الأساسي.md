# المرحلة 01: التصميم المعماري الأساسي

تُعد هذه المرحلة حجر الزاوية في بناء أداة ترجمة الفيديو، حيث يتم فيها وضع التصور العام والهيكل الأساسي للنظام، وتحديد المكونات الرئيسية وكيفية تفاعلها. يهدف التصميم المعماري إلى توفير إطار عمل قوي ومرن وقابل للتوسع.

## 1. الهيكل العام للأداة:

يمكن أن تتخذ الأداة أشكالاً متعددة بناءً على نطاق الاستخدام والمنصة المستهدفة. بناءً على الملفات المرفقة، يبرز التركيز على **إضافة متصفح** مع إمكانية وجود **خادم مساعد**:

*   **إضافة متصفح (Browser Extension):** هي البنية الأساسية المقترحة، وتعتمد على تقنيات الواجهة الأمامية مثل JavaScript/TypeScript وHTML5/CSS3. تستهدف هذه البنية التفاعل المباشر مع محتوى الفيديو داخل المتصفح. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **تطبيق ويب (Web Application):** يمكن أن تكون لوحة التحكم الشاملة (Settings Dashboard) جزءًا من تطبيق ويب مستقل أو مدمجًا ضمن الإضافة، مما يوفر واجهة متقدمة لإدارة الإعدادات والتقارير. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **تطبيق جوال (Mobile Application):** لم يتم ذكرها بشكل صريح كبنية أساسية، ولكن يمكن أن تكون امتدادًا مستقبليًا للنظام. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

## 2. المكونات الرئيسية:

يعتمد التصميم المعماري على بنية ثلاثية الطبقات (Presentation, Business Logic, Data Layer) لضمان فصل الاهتمامات وسهولة الصيانة والتطوير. المكونات الرئيسية هي:

### 2.1. واجهة المستخدم (UI Layer):

تتكون من عدة وحدات فرعية لتقديم تجربة مستخدم متكاملة:

*   **Popup Interface:** نافذة منبثقة سريعة للتحكم الأساسي، ومسارها الصحيح هو `src/popup/popup.html`. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **Options Panel:** لوحة إعدادات متقدمة، ومسارها الصحيح هو `src/options/options.html`. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **Content Overlay:** تراكب الترجمة مباشرة على الفيديو. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **Settings Dashboard:** لوحة تحكم شاملة للإعدادات والتقارير. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

**التقنيات المقترحة للواجهة الأمامية:**

*   **لغات البرمجة:** JavaScript/TypeScript، HTML5/CSS3. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **أطر العمل:** React.js (للوحة التحكم التفاعلية والمتقدمة)، Vue.js (بديل خفيف وسريع)، Svelte (لحجم أصغر وأداء أفضل). (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **مكتبات الواجهة:** Tailwind CSS (لتنسيق سريع ومتجاوب)، Material-UI (لمكونات جاهزة)، Framer Motion (للرسوم المتحركة). (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

### 2.2. محرك الترجمة (Translation Engine):

يعتبر القلب النابض للأداة، ويتم تصميمه ليكون مرنًا وقادرًا على التعامل مع محركات ترجمة متعددة:

*   **Translation Orchestrator:** المكون المركزي الذي يدير عملية الترجمة. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **Engine Router:** يوجه طلبات الترجمة إلى المحرك المناسب. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **Fallback Manager:** يدير المحركات الاحتياطية في حال فشل المحرك الأساسي. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **Cache Layer:** للتخزين المؤقت للترجمات لتحسين الأداء. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **Quality Assessor:** لتقييم جودة الترجمة (ميزة متقدمة). (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **API Manager:** لإدارة واجهات برمجة التطبيقات الخاصة بمحركات الترجمة المختلفة. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

**المحركات المدعومة:** تشمل محركات مجانية (مثل LibreTranslate، Apertium، Argos Translate) ومدفوعة (مثل Google Translate، DeepL، Microsoft Azure، Amazon Translate، OpenAI) ونماذج محلية (مثل NLLB-200، Hugging Face Transformers)، بالإضافة إلى وضع مختلط. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

### 2.3. نظام التقاط الصوت (Audio Capture System):

مسؤول عن التقاط الصوت من مصادر مختلفة ومعالجته:

*   **Audio Capture Manager:** يدير عملية الالتقاط. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **Capture Strategies:** تتضمن الالتقاط المباشر من الفيديو، التقاط التبويب، التقاط مستوى النظام، والميكروفون. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **Audio Processor:** لمعالجة الصوت (تقليل الضوضاء، تطبيع الصوت، تحويل الصيغ). (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **STT Engine (Speech-to-Text):** لتحويل الكلام إلى نص (مثل OpenAI Whisper، Mozilla DeepSpeech، Vosk). (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

**التقنيات المقترحة للصوت:** Web Audio API، FFmpeg.wasm (لتحويل صيغ الصوت)، TensorFlow.js (لنماذج STT المحلية). (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

### 2.4. نظام إدارة البيانات (Data Management):

يُعنى بتخزين واسترجاع البيانات بكفاءة:

*   **هيكل قواعد البيانات:** يتضمن قواعد بيانات منفصلة للإعدادات (Settings DB)، أرشيف الترجمة (Translation Archive)، والتخزين المؤقت (Cache DB). (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
    *   `Settings DB`: لتفضيلات المستخدم، إعدادات المحركات، وإعدادات الواجهة.
    *   `Translation Archive`: لتخزين الترجمات، مقاطع الصوت، والبيانات الوصفية.
    *   `Cache DB`: للتخزين المؤقت للترجمات والصوت والنماذج.
*   **تقنيات التخزين:** IndexedDB (للأرشيف والبيانات الكبيرة)، Chrome Storage (للإعدادات والمعلومات الأساسية)، Local Cache (للتخزين المؤقت السريع). (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

### 2.5. واجهات برمجة التطبيقات (APIs Layer):

تسهل التواصل بين المكونات الداخلية والخارجية:

*   **الواجهات الداخلية (Internal APIs):**
    *   `Translation API`: لوظائف الترجمة واكتشاف اللغة.
    *   `Audio API`: لالتقاط ومعالجة الصوت وتحويله إلى نص.
    *   `Storage API`: لحفظ واسترجاع وتصدير البيانات.
*   **الواجهات الخارجية (External APIs):** للتكامل مع خدمات الترجمة الخارجية (Google, DeepL)، خدمات تحويل الكلام إلى نص (Whisper, Google STT)، وخدمات التخزين السحابي (Google Drive, Dropbox). (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

## 3. التصميم التقني التفصيلي:

يتضمن تفاصيل حول البنية الخلفية، طبقة المحتوى، ونظام الاتصال:

### 3.1. طبقة الخلفية (Background Layer):

تُشغل في خلفية المتصفح وتدير المهام غير المرئية:

*   **Service Worker:** لمعالجة الرسائل، إدارة الحالة، والمهام الخلفية. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **Event System:** لنظام الأحداث، توجيه الرسائل، ومزامنة الحالة. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **Resource Manager:** لإدارة الذاكرة، التحكم في التخزين المؤقت، ومراقبة الأداء. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

### 3.2. طبقة المحتوى (Content Layer):

تتفاعل مباشرة مع محتوى صفحات الويب:

*   **Video Detector:** لاكتشاف عناصر الفيديو في DOM، التعرف على الفيديو، وحقن المشغل. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **Overlay Manager:** لعرض الترجمة (Subtitle Renderer)، حساب الموضع، وتطبيق الأنماط. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **Communication Bridge:** لنقل الرسائل، مزامنة الحالة، ومعالجة الأخطاء بين طبقة المحتوى والخلفية. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

### 3.3. نظام الاتصال بين المكونات:

يعتمد على نظام رسائل قوي:

*   **Cross-component Messaging:** طلب-استجابة، نشر الأحداث، ونشر الحالة. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **Cross-context Communication:** للتواصل بين `Content ↔ Background`، `Popup ↔ Background`، و `Options ↔ Background`. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)
*   **External Communication:** لاستدعاءات API، اتصالات WebSocket، ومزامنة التخزين. (مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

## 4. تصميم قاعدة البيانات:

كما ذكر أعلاه، يتم استخدام IndexedDB و Chrome Storage بشكل أساسي، مع هيكل منطقي لتقسيم البيانات:

*   **`Settings DB`:**
    *   `user_preferences`: تفضيلات المستخدم العامة.
    *   `engine_configs`: إعدادات محركات الترجمة.
    *   `ui_settings`: إعدادات واجهة المستخدم.
*   **`Translation Archive`:**
    *   `translations`: النصوص المترجمة واللغات المصدر والهدف.
    *   `audio_segments`: مقاطع الصوت المرتبطة بالترجمات.
    *   `metadata`: بيانات وصفية للترجمات (مثل وقت الترجمة، مصدر الفيديو).
*   **`Cache DB`:**
    *   `translation_cache`: للترجمات المخزنة مؤقتًا.
    *   `audio_cache`: لمقاطع الصوت المخزنة مؤقتًا.
    *   `model_cache`: للنماذج المحلية المخزنة مؤقتًا.
(مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

## 5. هندسة البرمجيات (أنماط التصميم):

لضمان جودة الكود وقابليته للتوسع والصيانة، تُستخدم أنماط تصميم وهندسة برمجيات متنوعة:

*   **أنماط هندسية:**
    *   **Microservices Architecture:** للوحدات المستقلة (مثل محرك الترجمة، نظام التقاط الصوت).
    *   **Event-Driven Architecture:** للاستجابة للأحداث (مثل اكتشاف الفيديو، انتهاء الترجمة).
    *   **Layered Architecture:** لفصل الاهتمامات (واجهة المستخدم، المنطق، البيانات).
    *   **Component-Based Architecture:** لإعادة استخدام المكونات (مكونات الواجهة).
*   **أنماط التصميم (Design Patterns):**
    *   **Observer Pattern:** للاتصال بين المكونات (مثل تحديث الواجهة عند اكتمال الترجمة).
    *   **Strategy Pattern:** لمحركات الترجمة المختلفة (لتبديل محركات الترجمة بسهولة).
    *   **Factory Pattern:** لإنشاء الكائنات (مثل إنشاء مثيلات لمختلف محركات STT).
    *   **Singleton Pattern:** للإدارة المركزية (مثل مدير التخزين المؤقت).
(مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

## 6. التكاملات الخارجية:

تتطلب الأداة التكامل مع خدمات خارجية لتقديم وظائفها الأساسية والمتقدمة:

*   **خدمات الترجمة:** Google Translate, DeepL, Microsoft Translator, Amazon Translate, OpenAI (لنماذج LLM).
*   **خدمات تحويل الكلام إلى نص (STT):** OpenAI Whisper, Google STT.
*   **خدمات التخزين السحابي:** Google Drive, Dropbox (للتصدير والاستيراد والمزامنة).
*   **خدمات التحليلات:** لتتبع الاستخدام ومقاييس الأداء.
*   **خدمات الأمان:** JWT للمصادقة، CryptoJS للتشفير.
(مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

## 7. نظام الأمان والخصوصية:

يتم تضمين طبقات حماية متعددة لضمان أمان البيانات وخصوصية المستخدم:

*   **تشفير البيانات:** تشفير التخزين المحلي، تشفير حركة مرور الشبكة، حماية مفاتيح API.
*   **التحكم في الوصول:** إدارة الأذونات، مصادقة المستخدم، إدارة الجلسات.
*   **حماية الخصوصية:** إخفاء هوية البيانات، المعالجة المحلية قدر الإمكان، سياسات واضحة لمسح البيانات.
(مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

## 8. نظام المراقبة والأداء:

لضمان استقرار الأداة وكفاءتها:

*   **مراقبة الأداء:** تتبع زمن الاستجابة، استخدام الذاكرة، استخدام وحدة المعالجة المركزية.
*   **الإبلاغ عن الأخطاء:** معالجة الاستثناءات، تسجيل الأخطاء، الإبلاغ عن الأعطال.
*   **التحليلات:** إحصائيات الاستخدام، تتبع استخدام الميزات، تحليلات الأداء.
(مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

## 9. مخطط تدفق البيانات:

يوضح هذا المخطط كيفية تدفق البيانات خلال عملية الترجمة النموذجية:

1.  **اكتشاف الفيديو:** يتم اكتشاف الفيديو بواسطة Content Script.
2.  **بدء الالتقاط:** يقوم نظام التقاط الصوت ببدء عملية الالتقاط.
3.  **معالجة الصوت:** يتم معالجة الصوت الملتقط بواسطة Audio Processor.
4.  **تحويل الكلام إلى نص:** يتم تحويل الصوت المعالج إلى نص بواسطة STT Engine.
5.  **ترجمة النص:** يتم ترجمة النص بواسطة Translation Orchestrator.
6.  **عرض الترجمة:** يتم عرض الترجمة على واجهة المستخدم (UI Overlay).
7.  **حفظ النتائج:** يتم حفظ النتائج في نظام التخزين (Storage System).

**تدفق البيانات العام:**

`User Interaction → UI Layer → Event Bus → Core Processing → External APIs → Data Storage → Response → UI Update`
(مستخلص من: `المرحلةالأولى_تصميمالنظامالمعماريالأساسي..md`)

---
